<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Usage – QA Catalogue</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./validate.html" rel="next">
<link href="./download.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-6b2306b05fee0b85d8c2d824c36e28c3.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-44dc98e9741501ddd657a828a82770d4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./usage.html">Usage</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">QA Catalogue</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Installation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quick-start-guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Quick start guide</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./build.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Build from source</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./download.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Download</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./usage.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Usage</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./validate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Validating MARC records</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./formatter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Display one MARC record, or extract data elements from MARC records</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./completeness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Completeness</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./thompson-traill-completeness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Thompson-Traill completeness</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./shelf-ready-completeness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Shelf-ready completeness</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./serial-score-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Serial score analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FRBR-functional-requirements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">FRBR functional requirement analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Classification analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./authority-name-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Authority name analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./field-frequency-distribution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Field frequency distribution</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./generating-cataloguing-history-chart.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Generating cataloguing history chart</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./import-tables-to-SQLite.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Import tables to SQLite</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./indexing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Indexing bibliographic records with Solr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./avram-schemas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Avram Schemas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Shacl4Bib.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Shacl4Bib</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./where-can-I-get-MARC-records.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Where can I get MARC records?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handling-MARC-versions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Handling MARC versions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./marcspec.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">MARCspec tutorial</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./institutions-which-reportedly-use-this-tool.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Institutions which reportedly use this tool</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./supporters-and-sponsors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">supporters-and-sponsors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./special-build-process.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Special build process</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./build-docker-image.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Build Docker image</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./contributing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Contributing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./apidoc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Java API</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">J</span>&nbsp; <span class="chapter-title">For Python developers</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#helper-scripts" id="toc-helper-scripts" class="nav-link active" data-scroll-target="#helper-scripts">Helper scripts</a>
  <ul class="collapse">
  <li><a href="#run" id="toc-run" class="nav-link" data-scroll-target="#run">run</a></li>
  <li><a href="#configuration" id="toc-configuration" class="nav-link" data-scroll-target="#configuration">configuration</a></li>
  </ul></li>
  <li><a href="#detailed-instructions" id="toc-detailed-instructions" class="nav-link" data-scroll-target="#detailed-instructions">Detailed instructions</a>
  <ul class="collapse">
  <li><a href="#general-parameters" id="toc-general-parameters" class="nav-link" data-scroll-target="#general-parameters">General parameters</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/pkiraly/qa-catalogue/blob/main/usage.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/pkiraly/qa-catalogue/edit/main/usage.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li><li><a href="https://github.com/pkiraly/qa-catalogue/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Usage</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="helper-scripts" class="level2">
<h2 class="anchored" data-anchor-id="helper-scripts">Helper scripts</h2>
<p>The tool comes with some bash helper scripts to run all these with default values. The generic scripts locate in the root directory and library specific configuration like scripts exist in the <code>catalogues</code> directory. You can find predefined scripts for several library catalogues (if you want to run it, first you have to configure it). All these scrips mainly contain configuration, and then it calls the central <code>common-script</code> which contains the functions.</p>
<p>If you do not want to</p>
<section id="run" class="level3">
<h3 class="anchored" data-anchor-id="run">run</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">catalogues/[your</span> script] [command<span class="er">(</span><span class="ex">s</span><span class="kw">)</span><span class="ex">]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>or</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./qa-catalogue</span> <span class="at">--params</span><span class="op">=</span><span class="st">"[options]"</span> [command<span class="er">(</span><span class="ex">s</span><span class="kw">)</span><span class="ex">]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The following commands are supported:</p>
<ul>
<li><code>validate</code> – runs validation</li>
<li><code>completeness</code> – runs completeness analysis</li>
<li><code>classifications</code> – runs classification analysis</li>
<li><code>authorities</code> – runs authorities analysis</li>
<li><code>tt-completeness</code> – runs Thomson-Trail completeness analysis</li>
<li><code>shelf-ready-completeness</code> – runs shelf-ready completeness analysis</li>
<li><code>serial-score</code> – calculates the serial scores</li>
<li><code>format</code> – runs formatting records</li>
<li><code>functional-analysis</code> – runs functional analysis</li>
<li><code>pareto</code> – runs pareto analysis</li>
<li><code>marc-history</code> – generates cataloguing history chart</li>
<li><code>prepare-solr</code> – prepare Solr index (you should already have Solr running, and index created)</li>
<li><code>index</code> – runs indexing with Solr</li>
<li><code>sqlite</code> – import tables to SQLite</li>
<li><code>export-schema-files</code> – export schema files</li>
<li><code>all-analyses</code> – run all default analysis tasks</li>
<li><code>all-solr</code> – run all indexing tasks</li>
<li><code>all</code> – run all tasks</li>
<li><code>config</code> – show configuration of selected catalogue</li>
</ul>
<p>You can find information about these functionalities below this document.</p>
</section>
<section id="configuration" class="level3">
<h3 class="anchored" data-anchor-id="configuration">configuration</h3>
<ol type="1">
<li>create the configuration file (setdir.sh)</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> setdir.sh.template setdir.sh</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ol start="2" type="1">
<li>edit the file configuration file. Two lines are important here</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="va">BASE_INPUT_DIR</span><span class="op">=</span>your/path</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="va">BASE_OUTPUT_DIR</span><span class="op">=</span>your/path</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="va">BASE_LOG_DIR</span><span class="op">=</span>=your/path</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><code>BASE_INPUT_DIR</code> is the parent directory where your MARC records exists</li>
<li><code>BASE_OUTPUT_DIR</code> is where the analysis results will be stored</li>
<li><code>BASE_LOG_DIR</code> is where the analysis logs will be stored</li>
</ul>
<ol start="3" type="1">
<li>edit the library specific file</li>
</ol>
<p>Here is an example file for analysing Library of Congress’ MARC records</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env bash</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="bu">.</span> ./setdir.sh</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="va">NAME</span><span class="op">=</span>loc</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="va">MARC_DIR</span><span class="op">=</span><span class="va">${BASE_INPUT_DIR}</span>/loc/marc</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="va">MASK</span><span class="op">=</span><span class="pp">*</span>.mrc</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="bu">.</span> ./common-script</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Three variables are important here:</p>
<ol type="1">
<li><code>NAME</code> is a name for the output directory. The analysis result will land under <span class="math inline">\(BASE_OUTPUT_DIR/\)</span>NAME directory</li>
<li><code>MARC_DIR</code> is the location of MARC files. All the files should be in the same directory</li>
<li><code>MASK</code> is a file mask, such as <code>*.mrc</code>, <code>*.marc</code> or <code>*.dat.gz</code>. Files ending with <code>.gz</code> are uncompressed automatically.</li>
</ol>
<p>You can add here any other parameters this document mentioned at the description of individual command, wrapped in TYPE_PARAMS variable e.g.&nbsp;for the Deutche Nationalbibliothek’s config file, one can find this</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="va">TYPE_PARAMS</span><span class="op">=</span><span class="st">"--marcVersion DNB --marcxml"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This line sets the DNB’s MARC version (to cover fields defined within DNB’s MARC version), and XML as input format.</p>
<p>The following table summarizes the configuration variables. The script <code>qa-catalogue</code> can be used to set variables and execute analysis without a library specific configuration file:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 23%">
<col style="width: 63%">
</colgroup>
<thead>
<tr class="header">
<th>variable</th>
<th><code>qa-catalogue</code></th>
<th>description</th>
<th>default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>ANALYSES</code></td>
<td><code>-a</code>/<code>--analyses</code></td>
<td>which tasks to run with <code>all-analyses</code></td>
<td><code>validate, validate_sqlite, completeness, completeness_sqlite, classifications, authorities, tt_completeness, shelf_ready_completeness, serial_score, functional_analysis, pareto, marc_history</code></td>
</tr>
<tr class="even">
<td></td>
<td><code>-c</code>/<code>--catalogue</code></td>
<td>display name of the catalogue</td>
<td><code>$NAME</code></td>
</tr>
<tr class="odd">
<td><code>NAME</code></td>
<td><code>-n</code>/<code>--name</code></td>
<td>name of the catalogue</td>
<td>qa-catalogue</td>
</tr>
<tr class="even">
<td><code>BASE_INPUT_DIR</code></td>
<td><code>-d</code>/<code>--input</code></td>
<td>parent directory of input file directories</td>
<td><code>./input</code></td>
</tr>
<tr class="odd">
<td><code>INPUT_DIR</code></td>
<td><code>-d</code>/<code>--input-dir</code></td>
<td>subdirectory of input directory to read files from</td>
<td></td>
</tr>
<tr class="even">
<td><code>BASE_OUTPUT_DIR</code></td>
<td><code>-o</code>/<code>--output</code></td>
<td>parent output directory</td>
<td><code>./output</code></td>
</tr>
<tr class="odd">
<td><code>BASE_LOG_DIR</code></td>
<td><code>-l</code>/<code>--logs</code></td>
<td>directory of log files</td>
<td><code>./logs</code></td>
</tr>
<tr class="even">
<td><code>MASK</code></td>
<td><code>-m</code>/<code>--mask</code></td>
<td>a file mask which input files to process, e.g.&nbsp;<code>*.mrc</code></td>
<td><code>*</code></td>
</tr>
<tr class="odd">
<td><code>TYPE_PARAMS</code></td>
<td><code>-p</code>/<code>--params</code></td>
<td>parameters to pass to individual tasks (see below)</td>
<td></td>
</tr>
<tr class="even">
<td><code>SCHEMA</code></td>
<td><code>-s</code>/<code>--schema</code></td>
<td>record schema</td>
<td><code>MARC21</code></td>
</tr>
<tr class="odd">
<td><code>UPDATE</code></td>
<td><code>-u</code>/<code>--update</code></td>
<td>optional date of input files</td>
<td></td>
</tr>
<tr class="even">
<td><code>VERSION</code></td>
<td><code>-v</code>/<code>--version</code></td>
<td>optional version number/date of the catalogue to compare changes</td>
<td></td>
</tr>
<tr class="odd">
<td><code>WEB_CONFIG</code></td>
<td><code>-w</code>/<code>--web-config</code></td>
<td>update the specified configuration file of qa-catalogue-web</td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td><code>-f</code>/<code>--env-file</code></td>
<td>configuration file to load environment variables from (default: <code>.env</code>)</td>
<td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="detailed-instructions" class="level2">
<h2 class="anchored" data-anchor-id="detailed-instructions">Detailed instructions</h2>
<p>We will use the same jar file in every command, so we save its path into a variable.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">JAR</span><span class="op">=</span>target/metadata-qa-marc-0.7.0-jar-with-dependencies.jar</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="general-parameters" class="level3">
<h3 class="anchored" data-anchor-id="general-parameters">General parameters</h3>
<p>Most of the analyses uses the following general parameters</p>
<ul>
<li><code>--schemaType &lt;type&gt;</code> metadata schema type. The supported types are:
<ul>
<li><code>MARC21</code></li>
<li><code>PICA</code></li>
<li><code>UNIMARC</code> (assessment of UNIMARC records are not yet supported, this parameter value is only reserved for future usage)</li>
</ul></li>
<li><code>-m &lt;version&gt;</code>, <code>--marcVersion &lt;version&gt;</code> specifies a MARC version. Currently, the supported versions are:
<ul>
<li><code>MARC21</code>, Library of Congress MARC21</li>
<li><code>DNB</code>, the Deuthche Nationalbibliothek’s MARC version</li>
<li><code>OCLC</code>, the OCLCMARC</li>
<li><code>GENT</code>, fields available in the catalog of Gent University (Belgium)</li>
<li><code>SZTE</code>, fields available in the catalog of Szegedi Tudományegyetem (Hungary)</li>
<li><code>FENNICA</code>, fields available in the Fennica catalog of Finnish National Library</li>
<li><code>NKCR</code>, fields available at the National Library of the Czech Republic</li>
<li><code>BL</code>, fields available at the British Library</li>
<li><code>MARC21NO</code>, fields available at the MARC21 profile for Norwegian public libraries</li>
<li><code>UVA</code>, fields available at the University of Amsterdam Library</li>
<li><code>B3KAT</code>, fields available at the B3Kat union catalogue of Bibliotheksverbundes Bayern (BVB) and Kooperativen Bibliotheksverbundes Berlin-Brandenburg (KOBV)</li>
<li><code>KBR</code>, fields available at KBR, the national library of Belgium</li>
<li><code>ZB</code>, fields available at Zentralbibliothek Zürich</li>
<li><code>OGYK</code>, fields available at Országygyűlési Könyvtár, Budapest</li>
</ul></li>
<li><code>-n</code>, <code>--nolog</code> do not display log messages</li>
<li>parameters to limit the validation:
<ul>
<li><code>-i [record ID]</code>, <code>--id [record ID]</code> validates only a single record having the specifies identifier (the content of 001)</li>
<li><code>-l [number]</code>, <code>--limit [number]</code> validates only given number of records</li>
<li><code>-o [number]</code>, <code>--offset [number]</code> starts validation at the given Nth record</li>
<li><code>-z [list of tags]</code>, <code>--ignorableFields [list of tags]</code> do NOT validate the selected fields. The list should contain the tags separated by commas (<code>,</code>), e.g.&nbsp;<code>--ignorableFields A02,AQN</code></li>
<li><code>-v [selector]</code>, <code>--ignorableRecords [selector]</code> do NOT validate the records which match the condition denoted by the selector. The selector is a test MARCspec string e.g. <code>--ignorableRecords STA$a=SUPPRESSED</code>. It ignores the records which has <code>STA</code> field with an <code>a</code> subfield with the value <code>SUPPRESSED</code>.</li>
</ul></li>
<li><code>-d [record type]</code>, <code>--defaultRecordType [record type]</code> the default record type to be used if the record’s type is undetectable. The record type is calculated from the combination of Leader/06 (Type of record) and Leader/07 (bibliographic level), however sometimes the combination doesn’t fit to the standard. In this case the tool will use the given record type. Possible values of the record type argument:
<ul>
<li>BOOKS</li>
<li>CONTINUING_RESOURCES</li>
<li>MUSIC</li>
<li>MAPS</li>
<li>VISUAL_MATERIALS</li>
<li>COMPUTER_FILES</li>
<li>MIXED_MATERIALS</li>
</ul></li>
<li>parameters to fix known issues before any analyses:
<ul>
<li><code>-q</code>, <code>--fixAlephseq</code> sometimes ALEPH export contains ‘^’ characters instead of spaces in control fields (006, 007, 008). This flag replaces them with spaces before the validation. It might occur in any input format.</li>
<li><code>-a</code>, <code>--fixAlma</code> sometimes Alma export contains ‘#’ characters instead of spaces in control fields (006, 007, 008). This flag replaces them with spaces before the validation. It might occur in any input format.</li>
<li><code>-b</code>, <code>--fixKbr</code> KBR’s export contains ‘#’ characters instead spaces in control fields (006, 007, 008). This flag replaces them with spaces before the validation. It might occur in any input format.</li>
</ul></li>
<li><code>-f &lt;format&gt;</code>, <code>--marcFormat &lt;format&gt;</code> The input format. Possible values are
<ul>
<li><code>ISO</code>: Binary (ISO 2709)</li>
<li><code>XML</code>: MARCXML (shortcuts: <code>-x</code>, <code>--marcxml</code>)</li>
<li><code>ALEPHSEQ</code>: Alephseq (shortcuts: <code>-p</code>, <code>--alephseq</code>)</li>
<li><code>LINE_SEPARATED</code>: Line separated binary MARC where each line contains one record) (shortcuts: <code>-y</code>, <code>--lineSeparated</code>)</li>
<li><code>MARC_LINE</code>: MARC Line is a line-separated format i.e.&nbsp;it is a text file, where each line is a distinct field, the same way as MARC records are usually displayed in the MARC21 standard documentation.</li>
<li><code>MARCMAKER</code>: MARCMaker format</li>
<li><code>PICA_PLAIN</code>: PICA plain (https://format.gbv.de/pica/plain) is a serialization format, that contains each fields in distinct row.</li>
<li><code>PICA_NORMALIZED</code>: normalized PICA (https://format.gbv.de/pica/normalized) is a serialization format where each line is a separate record (by bytecode <code>0A</code>). Fields are terminated by bytecode 1E, and subfields are introduced by bytecode <code>1F</code>.</li>
</ul></li>
<li><code>-t &lt;directory&gt;</code>, <code>--outputDir &lt;directory&gt;</code> specifies the output directory where the files will be created</li>
<li><code>-r</code>, <code>--trimId</code> remove spaces from the end of record IDs in the output files (some library system add padding spaces around field value 001 in exported files)</li>
<li><code>-g &lt;encoding&gt;</code>, <code>--defaultEncoding &lt;encoding&gt;</code> specify a default encoding of the records. Possible values:
<ul>
<li><code>ISO-8859-1</code> or <code>ISO8859_1</code> or <code>ISO_8859_1</code></li>
<li><code>UTF8</code> or <code>UTF-8</code></li>
<li><code>MARC-8</code> or <code>MARC8</code></li>
</ul></li>
<li><code>-s &lt;datasource&gt;</code>, <code>--dataSource &lt;datasource&gt;</code> specify the type of data source. Possible values:
<ul>
<li><code>FILE</code>: reading from file</li>
<li><code>STREAM</code>: reading from a Java data stream. It is not usable if you use the tool from the command line, only if you use it with its API.</li>
</ul></li>
<li><code>-c &lt;configuration&gt;</code>, <code>--allowableRecords &lt;configuration&gt;</code> if set, criteria which allows analysis of records. If the record does not met the criteria, it will be excluded. An individual criterium should be formed as a MarcSpec (for MARC21 records) or PicaFilter (for PICA records). Multiple criteria might be concatenated with logical operations: <code>&amp;&amp;</code> for AND, <code>||</code> for OR and <code>!</code> for not. One can use parentheses to group logical expressions. An example: <code>'002@.0 !~ "^L" &amp;&amp; 002@.0 !~ "^..[iktN]" &amp;&amp; (002@.0 !~ "^.v" || 021A.a?)'</code>. Since the criteria might form a complex phase containing spaces, the passing of which is problematic among multiple scripts, one can apply Base64 encoding. In this case add <code>base64:</code> prefix to the parameters, such as <code>base64:"$(echo '002@.0 !~ "^L" &amp;&amp; 002@.0 !~ "^..[iktN]" &amp;&amp; (002@.0 !~ "^.v" || 021A.a?)' | base64 -w 0)</code>.</li>
<li><code>-1 &lt;type&gt;</code>, <code>--alephseqLineType &lt;type&gt;</code>, true, “Alephseq line type. The <code>type</code> could be
<ul>
<li><code>WITH_L</code>: the records’ AlephSeq lines contain an <code>L</code> string (e.g.&nbsp;<code>000000002 008   L 780804s1977^^^^enk||||||b||||001^0|eng||</code>)</li>
<li><code>WITHOUT_L</code>: the records’ AlephSeq lines do not contai an <code>L</code> string (e.g.&nbsp;<code>000000002 008   780804s1977^^^^enk||||||b||||001^0|eng||</code>)</li>
</ul></li>
<li>PICA related parameters
<ul>
<li><code>-2 &lt;path&gt;</code>, <code>--picaIdField &lt;path&gt;</code> the record identifier</li>
<li><code>-u &lt;char&gt;</code>, <code>--picaSubfieldSeparator &lt;char&gt;</code> the PICA subfield separator. subfield of PICA records. Default is <code>003@$0</code>. Default is <code>$</code>.</li>
<li><code>-j &lt;file&gt;</code>, <code>--picaSchemaFile &lt;file&gt;</code> an Avram schema file, which describes the structure of PICA records</li>
<li><code>-k &lt;path&gt;</code>, <code>--picaRecordType &lt;path&gt;</code> The PICA subfield which stores the record type information. Default is <code>002@$0</code>.</li>
</ul></li>
<li>Parameters for grouping analyses
<ul>
<li><code>-e &lt;path&gt;</code>, <code>--groupBy &lt;path&gt;</code> group the results by the value of this data element (e.g.&nbsp;the ILN of libraries holding the item). An example: <code>--groupBy 001@$0</code> where <code>001@$0</code> is the subfield containing the comma separated list of library ILN codes.</li>
<li><code>-3 &lt;file&gt;</code>, <code>--groupListFile &lt;file&gt;</code> the file which contains a list of ILN codes</li>
</ul></li>
</ul>
<p>The last argument of the commands are a list of files. It might contain any wildcard the operating system supports (’*‘,’?’, etc.).</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./download.html" class="pagination-link" aria-label="Download">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Download</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./validate.html" class="pagination-link" aria-label="Validating MARC records">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Validating MARC records</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/pkiraly/qa-catalogue/blob/main/usage.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/pkiraly/qa-catalogue/edit/main/usage.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li><li><a href="https://github.com/pkiraly/qa-catalogue/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>